@using ActiveLogin.Identity.Swedish
@model SwedishPersonalIdentityNumberTestdataListViewModel;

@{
    ViewBag.Title = "Testdata - Swedish Personal Identity Numbers";
}

<h1 class="h2">
    Testdata
    <small class="text-muted">Swedish Personal Identity Numbers</small>
</h1>

<p class="lead py-3">
    Swedish Personal Identity Numbers (PIN) should <a href="https://www.datainspektionen.se/other-lang/in-english/the-general-data-protection-regulation-gdpr/sensitive-personal-data/">be treated as personal data</a> and therefore a valid PIN can't be used in scenarios such as testing. For this very purpose <a href="https://skatteverket.entryscape.net/catalog/9/datasets/147">Skatteverket has issued a list of testdata</a> with numbers guaranteed not to be given to a person, and they are therefore safe to use. The list below builds upon that orignal list, but enhances it by extracting information such as date of birth, gender and age.
</p>

<form asp-action="TestDataList" method="get">
    <div class="form-row">
        <div class="form-group col-md-6 col-lg-2">
            <label asp-for="Query.DateOfBirth.From">Date of Birth <small class="text-muted">(from)</small></label>
            <input type="date" class="form-control" name="dateofbirth.from" asp-for="Query.DateOfBirth.From" />
        </div>
        <div class="form-group col-md-6 col-lg-2">
            <label asp-for="Query.DateOfBirth.To">Date of Birth <small class="text-muted">(to)</small></label>
            <input type="date" class="form-control" name="dateofbirth.to" asp-for="Query.DateOfBirth.To" />
        </div>
        <div class="form-group col-md-6 col-lg-2">
            <label asp-for="Query.Age.From">Age <small class="text-muted">(from)</small></label>
            <input type="number" class="form-control" name="age.from" asp-for="Query.Age.From" min="0" />
        </div>
        <div class="form-group col-md-6 col-lg-2">
            <label asp-for="Query.Age.To">Age <small class="text-muted">(to)</small></label>
            <input type="number" class="form-control" name="age.to" asp-for="Query.Age.To" />
        </div>
        <div class="form-group col-md-6 col-lg-2">
            <label asp-for="Query.Gender">Gender</label>
            <select class="form-control" name="gender" asp-for="Query.Gender">
                <option value="" selected>All</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
            </select>
        </div>
        <div class="form-group col-md-6 col-lg-2 ii-filter-submit-group">
            <button type="submit" class="btn btn-primary btn-block">Filter</button>
        </div>
    </div>
</form>


@if (Model.Result.SwedishPersonalIdentityNumbersCount > 0)
{
    if (Model.Query.Limit.HasValue)
    {
        <nav class="d-flex justify-content-between mb-3">
            <ul class="pagination mb-0">
                @{
                    var limit = Model.Query.Limit ?? 100;
                    var totalPages = (Model.Result.SwedishPersonalIdentityNumbersCount + limit - 1) / limit;

                    var currentOffset = Model.Query.Offset ?? 0;
                    var currentPageNumber = (currentOffset / limit) + 1;

                    var rangeItems = 4;
                    var rangeFromPageNumber = Math.Max(currentPageNumber - rangeItems, 1);
                    var rangeToPageNumber = Math.Min(rangeFromPageNumber + rangeItems, totalPages);

                    var enablePrev = currentPageNumber > 1;
                    var enableNext = currentPageNumber < totalPages;

                    var showFirstPage = rangeFromPageNumber > 1;
                    var showLastPage = totalPages > rangeToPageNumber;
                }

                @if (enablePrev)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Model.Query.ToQueryString(currentOffset - limit)">&laquo;</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">&laquo;</span>
                    </li>
                }

                @if (showFirstPage)
                {
                    <li class="page-item"><a class="page-link" href="@Model.Query.ToQueryString(0)">1</a></li>
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                }

                @for (var i = rangeFromPageNumber - 1; i < rangeToPageNumber; i++)
                {
                    var offset = i * limit;
                    var pageNumber = i + 1;

                    if (pageNumber == currentPageNumber)
                    {
                        <li class="page-item active">
                            <span class="page-link">@pageNumber</span>
                        </li>
                    }
                    else
                    {
                        <li class="page-item">
                            <a class="page-link" href="@Model.Query.ToQueryString(offset)">@pageNumber</a>
                        </li>
                    }
                }

                @if (showLastPage)
                {
                    <li class="page-item disabled">
                        <span class="page-link" href="" tabindex="-1">
                            ...
                        </span>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="@Model.Query.ToQueryString((totalPages - 1) * limit)">@totalPages</a>
                    </li>
                }

                @if (enableNext)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Model.Query.ToQueryString(currentOffset + limit)">&raquo;</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">&raquo;</span>
                    </li>
                }
            </ul>

            <div class="py-1 d-none d-lg-block">
                @if (Model.Result.SwedishPersonalIdentityNumbersCount == Model.Result.TotalRows)
                {
                    <text>Showing all @Model.Result.TotalRows.ToString("N0") results.</text>
                }
                else
                {
                    <text>Showing @Model.Result.SwedishPersonalIdentityNumbersCount.ToString("N0") of @Model.Result.TotalRows.ToString("N0") results.</text>
                }
            </div>
        </nav>
    }

    <div class="table-responsive-sm">

        <table class="table table-striped table-hover">
            <thead class="thead-dark thead-sticky">
                <tr>
                    <th scope="col">10 Digit</th>
                    <th scope="col">12 Digit</th>
                    <th scope="col" class="d-none d-lg-table-cell">Year</th>
                    <th scope="col" class="d-none d-lg-table-cell">Month</th>
                    <th scope="col" class="d-none d-lg-table-cell">Day</th>
                    <th scope="col" class="d-none d-lg-table-cell">Delimiter</th>
                    <th scope="col" class="d-none d-lg-table-cell">BirthNumber</th>
                    <th scope="col" class="d-none d-lg-table-cell">Checksum</th>
                    <th scope="col">Gender</th>
                    <th scope="col">Date of Birth</th>
                    <th scope="col">Age</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var number in Model.Result.SwedishPersonalIdentityNumbers)
                {
                    <tr>
                        <th scope="row">@number.TenDigitString</th>
                        <td>@number.TwelveDigitString</td>
                        <td class="d-none d-lg-table-cell">@number.Year</td>
                        <td class="d-none d-lg-table-cell">@number.Month</td>
                        <td class="d-none d-lg-table-cell">@number.Day</td>
                        <td class="d-none d-lg-table-cell">@number.Delimiter</td>
                        <td class="d-none d-lg-table-cell">@number.BirthNumber</td>
                        <td class="d-none d-lg-table-cell">@number.Checksum</td>
                        <td>
                            <i class="fal fa-@(number.GenderHint == Gender.Female ? "venus" : "mars")" title="@number.GenderHint"></i>
                            @number.GenderHint
                        </td>
                        <td>@number.DateOfBirthHint.ToShortDateString()</td>
                        <td>@(number.AgeHint?.ToString("D") ?? "N/A")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-info" role="alert">
        No results matched the current filter.
    </div>
}